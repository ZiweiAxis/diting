# Diting 项目任务计划清单

## 📊 当前状态总览

**项目名称**: Diting (谛听) - AI Agent 零信任治理平台  
**当前版本**: v0.1.0 MVP  
**最后更新**: 2026-02-08  
**GitHub**: https://github.com/hulk-yin/diting

---

## ✅ 已完成（MVP 阶段）

### 核心功能
- [x] DNS 劫持配置（CoreDNS）
- [x] Go 动态反向代理
- [x] 基础风险评估（规则引擎）
- [x] LLM 意图分析（Ollama/OpenAI）
- [x] CLI 人工审批
- [x] JSONL 审计日志
- [x] 项目架构重构（Go-only）
- [x] 完整文档（18个文档）

### 文档
- [x] README.md（中英文）
- [x] 完整架构文档（ARCHITECTURE_FULL.md）
- [x] 部署模式说明（DEPLOYMENT_MODES.md）
- [x] LICENSE（MIT）
- [x] CONTRIBUTING.md
- [x] CODE_OF_CONDUCT.md

### 基础设施
- [x] Git 仓库初始化
- [x] GitHub 发布
- [x] Docker 配置
- [x] 项目结构规范化

---

## 🔥 当前优先级（P0 - 紧急）

### 1. 完善 Go 反向代理核心功能
**目标**: 让 MVP 真正可用

#### 1.1 支持 HTTPS 代理 ⚠️ 关键
- [ ] 实现 CONNECT 方法支持
- [ ] TLS 证书处理
- [ ] SNI（Server Name Indication）支持
- [ ] 自签名证书生成

**为什么重要**: 现在只支持 HTTP，但大部分 API 都是 HTTPS

#### 1.2 完善 Host 头解析
- [ ] 从 Host 头获取真实目标域名
- [ ] 动态 DNS 解析
- [ ] 连接池管理优化

#### 1.3 错误处理和重试
- [ ] 后端连接失败重试
- [ ] 超时处理
- [ ] 优雅降级

**预计时间**: 3-5 天  
**负责人**: 待定

---

### 2. 策略引擎基础框架
**目标**: 从硬编码规则到可配置策略

#### 2.1 策略配置文件
- [ ] YAML 配置格式设计
- [ ] 策略加载器
- [ ] 热重载支持

```yaml
# 示例配置
policies:
  - name: "禁止删除生产数据"
    conditions:
      - method: DELETE
      - path_contains: "/prod/"
    action: DENY
    
  - name: "限制 API 调用频率"
    conditions:
      - rate_limit: 100/min
    action: REVIEW
```

#### 2.2 权限策略（RBAC）
- [ ] 用户/角色模型
- [ ] 权限检查逻辑
- [ ] 配置文件支持

#### 2.3 风控策略
- [ ] 频率限制（Rate Limiting）
- [ ] 时间窗口限制
- [ ] IP 白名单/黑名单

**预计时间**: 5-7 天  
**负责人**: 待定

---

### 3. Web 管理后台（基础版）
**目标**: 可视化管理和审批

#### 3.1 后端 API
- [ ] RESTful API 设计
- [ ] 审计日志查询接口
- [ ] 策略管理接口
- [ ] 审批接口

#### 3.2 前端界面
- [ ] 登录页面
- [ ] 审计日志列表
- [ ] 实时审批界面
- [ ] 策略配置界面

**技术栈建议**: 
- 后端: Go + Gin/Echo
- 前端: Vue 3 + Element Plus / React + Ant Design

**预计时间**: 10-14 天  
**负责人**: 待定

---

## 📅 短期计划（1-2 周）

### Phase 1.1 - 核心功能完善

#### 代理功能
- [ ] HTTPS 代理支持（P0）
- [ ] WebSocket 代理支持
- [ ] gRPC 代理支持（可选）
- [ ] 性能优化（连接池、缓存）

#### 策略引擎
- [ ] 策略配置文件（YAML）
- [ ] 基础 RBAC 支持
- [ ] 频率限制（Rate Limiting）
- [ ] 策略热重载

#### 审计日志
- [ ] 日志轮转
- [ ] 日志压缩
- [ ] 日志查询 API
- [ ] 导出功能（CSV/JSON）

#### 测试
- [ ] 单元测试（覆盖率 > 60%）
- [ ] 集成测试
- [ ] 性能测试
- [ ] 压力测试

---

## 🎯 中期计划（1-2 月）

### Phase 2 - 企业级功能

#### 策略引擎增强
- [ ] ABAC（基于属性的访问控制）
- [ ] 复杂规则表达式
- [ ] 策略版本管理
- [ ] 策略审计

#### 企业集成
- [ ] LDAP/AD 集成
- [ ] OAuth2/OIDC 支持
- [ ] SAML 2.0 支持
- [ ] 企业微信审批
- [ ] 钉钉审批

#### 数据存储
- [ ] PostgreSQL 集成
- [ ] 审计日志持久化
- [ ] 用户/角色数据存储
- [ ] 策略配置存储

#### Web 管理后台
- [ ] 完整的审批工作流
- [ ] 多级审批支持
- [ ] 审计日志可视化
- [ ] 实时监控大屏
- [ ] 统计报表

#### 告警系统
- [ ] 实时告警规则
- [ ] 邮件通知
- [ ] 企业微信/钉钉通知
- [ ] Webhook 集成

---

## 🚀 长期计划（3-6 月）

### Phase 3 - 平台化

#### 高级分析
- [ ] 威胁情报集成
- [ ] 行为分析引擎
- [ ] 异常检测（机器学习）
- [ ] 风险趋势分析

#### 数据平台
- [ ] ClickHouse 集成（时序分析）
- [ ] Elasticsearch 集成（日志搜索）
- [ ] 数据可视化（Grafana/自研）
- [ ] 合规报告自动生成

#### 高级监控
- [ ] eBPF 内核级监控
- [ ] 性能监控（Prometheus）
- [ ] 链路追踪（Jaeger）
- [ ] 服务网格集成

#### 高可用
- [ ] 集群部署
- [ ] 负载均衡
- [ ] 故障转移
- [ ] 数据备份

---

## 🛠️ 技术债务

### 代码质量
- [ ] 添加单元测试
- [ ] 代码注释完善
- [ ] 错误处理规范化
- [ ] 日志规范化

### 文档
- [ ] API 文档（Swagger/OpenAPI）
- [ ] 部署文档完善
- [ ] 故障排查指南
- [ ] 最佳实践文档

### 性能
- [ ] 性能基准测试
- [ ] 内存泄漏检查
- [ ] 并发压力测试
- [ ] 性能优化

---

## 📋 下一步行动（本周）

### 立即可做（今天）
1. **完善 HTTPS 代理支持**
   - 实现 CONNECT 方法
   - 测试 HTTPS 请求转发
   
2. **创建策略配置文件格式**
   - 设计 YAML 配置结构
   - 实现配置加载器

3. **添加基础单元测试**
   - 测试风险评估逻辑
   - 测试策略匹配逻辑

### 本周目标
- [ ] HTTPS 代理完全可用
- [ ] 策略配置文件支持
- [ ] 基础单元测试（覆盖率 > 30%）
- [ ] 性能测试报告

---

## 🎯 里程碑

### v0.2.0 - 核心功能完善（2周）
- HTTPS 代理支持
- 策略配置文件
- 基础 RBAC
- 单元测试

### v0.3.0 - Web 管理后台（1月）
- Web UI
- 审批工作流
- 审计日志查询
- 策略管理界面

### v0.5.0 - 企业集成（2月）
- LDAP/AD 集成
- 企业微信/钉钉审批
- PostgreSQL 存储
- 告警系统

### v1.0.0 - 生产就绪（3月）
- 高可用部署
- 完整文档
- 性能优化
- 安全加固

---

## 📞 需要决策的问题

1. **Web 管理后台技术栈**
   - 前端: Vue 3 vs React？
   - 后端: 独立服务 vs 集成到主程序？

2. **数据库选择**
   - PostgreSQL（关系型）
   - MongoDB（文档型）
   - 两者结合？

3. **部署方式**
   - Docker Compose（简单）
   - Kubernetes（企业级）
   - 两者都支持？

4. **开源策略**
   - 完全开源（MIT）
   - 核心开源 + 企业版（双许可证）

---

## 🤝 如何参与

### 开发者
1. 查看 [CONTRIBUTING.md](../CONTRIBUTING.md)
2. 选择感兴趣的任务
3. 提交 Pull Request

### 用户
1. 试用 MVP 版本
2. 提交 Issue 反馈
3. 参与讨论

---

**最后更新**: 2026-02-08  
**维护者**: Diting Team
