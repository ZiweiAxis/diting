# é£ä¹¦å®¡æ‰¹é…ç½®å®Œæˆ âœ…

## ğŸ“‹ ä½ çš„é…ç½®ä¿¡æ¯

```json
{
  "feishu": {
    "app_id": "xxxx",
    "app_secret": "***",
    "approval_user_id": "xxxx",
    "approval_timeout_minutes": 5,
    "use_message_reply": true,
    "poll_interval_seconds": 2
  }
}
```

## ğŸ¯ æ–¹æ¡ˆ Bï¼šæ¶ˆæ¯å›å¤å®¡æ‰¹ï¼ˆæ— éœ€å…¬ç½‘ IPï¼‰

### å·¥ä½œæµç¨‹

```
1. Agent å‘èµ·é«˜é£é™©æ“ä½œ
   â†“
2. Diting æ‹¦æˆªå¹¶è¯„ä¼°é£é™©
   â†“
3. Claude Haiku åˆ†ææ„å›¾
   â†“
4. å‘é€é£ä¹¦æ¶ˆæ¯ç»™ä½ 
   â†“
5. ä½ åœ¨é£ä¹¦å›å¤ "æ‰¹å‡†" æˆ– "æ‹’ç»"
   â†“
6. Diting è½®è¯¢æ£€æµ‹åˆ°ä½ çš„å›å¤
   â†“
7. æ‰§è¡Œç›¸åº”æ“ä½œ + è®°å½•å®¡è®¡æ—¥å¿—
```

### å®¡æ‰¹æ¶ˆæ¯ç¤ºä¾‹

ä½ ä¼šæ”¶åˆ°è¿™æ ·çš„é£ä¹¦æ¶ˆæ¯ï¼š

```
ğŸš¨ Diting é«˜é£é™©æ“ä½œå®¡æ‰¹

æ“ä½œ: DELETE /api/users/123
é£é™©ç­‰çº§: é«˜ ğŸ”´
æ„å›¾åˆ†æ: è¯¥æ“ä½œå°†åˆ é™¤ç”¨æˆ·æ•°æ®ï¼Œæ“ä½œä¸å¯é€†ã€‚å»ºè®®è°¨æ…å®¡æ‰¹ã€‚

è¯·å›å¤ï¼š
âœ… "æ‰¹å‡†" æˆ– "approve" æˆ– "y" æ¥æ‰¹å‡†
âŒ "æ‹’ç»" æˆ– "reject" æˆ– "n" æ¥æ‹’ç»

â±ï¸ 5åˆ†é’Ÿå†…æœªå“åº”å°†è‡ªåŠ¨æ‹’ç»
è¯·æ±‚ID: req_1707365123456
```

### å¦‚ä½•å›å¤

**æ‰¹å‡†æ“ä½œ**ï¼ˆä»¥ä¸‹ä»»ä¸€å³å¯ï¼‰ï¼š
- `æ‰¹å‡†`
- `approve`
- `y`
- `yes`
- `åŒæ„`

**æ‹’ç»æ“ä½œ**ï¼ˆä»¥ä¸‹ä»»ä¸€å³å¯ï¼‰ï¼š
- `æ‹’ç»`
- `reject`
- `n`
- `no`
- `ä¸åŒæ„`

## ğŸš€ å¯åŠ¨æ­¥éª¤

### 1. ç¼–è¯‘æ–°ç‰ˆæœ¬

```bash
cd /home/dministrator/workspace/sentinel-ai/cmd/diting
export PATH=$HOME/go/bin:$PATH
go build -o diting main.go
```

### 2. å¯åŠ¨æœåŠ¡

```bash
./diting
```

ä½ ä¼šçœ‹åˆ°ï¼š

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         Diting æ²»ç†ç½‘å…³ v0.3.0                        â•‘
â•‘    ä¼ä¸šçº§æ™ºèƒ½ä½“é›¶ä¿¡ä»»æ²»ç†å¹³å° - é£ä¹¦å®¡æ‰¹é›†æˆ          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ é…ç½®åŠ è½½æˆåŠŸ
  LLM: Claude Haiku 3.5
  é£ä¹¦: æ¶ˆæ¯å›å¤æ¨¡å¼
  å®¡æ‰¹äºº: xxxx

âœ“ ä»£ç†æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ
  ç›‘å¬åœ°å€: http://localhost:8081
  æ”¯æŒåè®®: HTTP + HTTPS (CONNECT)
```

### 3. æµ‹è¯•å®¡æ‰¹æµç¨‹

**ç»ˆç«¯ 1**ï¼ˆå¯åŠ¨ Ditingï¼‰ï¼š
```bash
./diting
```

**ç»ˆç«¯ 2**ï¼ˆå‘èµ·é«˜é£é™©æ“ä½œï¼‰ï¼š
```bash
curl -x http://localhost:8081 -X DELETE http://httpbin.org/delete
```

**é£ä¹¦**ï¼ˆä½ ä¼šæ”¶åˆ°å®¡æ‰¹æ¶ˆæ¯ï¼‰ï¼š
- å›å¤ `æ‰¹å‡†` â†’ æ“ä½œæ‰§è¡Œ
- å›å¤ `æ‹’ç»` â†’ æ“ä½œè¢«é˜»æ­¢
- 5åˆ†é’Ÿä¸å›å¤ â†’ è‡ªåŠ¨æ‹’ç»

## ğŸ“Š æŠ€æœ¯ç»†èŠ‚

### é£ä¹¦ API è°ƒç”¨æµç¨‹

1. **è·å– Access Token**
   ```
   POST https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal
   Body: {
     "app_id": "xxxx",
     "app_secret": "***"
   }
   ```

2. **å‘é€å®¡æ‰¹æ¶ˆæ¯**
   ```
   POST https://open.feishu.cn/open-apis/im/v1/messages?receive_id_type=user_id
   Headers: {
     "Authorization": "Bearer {tenant_access_token}"
   }
   Body: {
     "receive_id": "xxxx",
     "msg_type": "text",
     "content": "{\"text\":\"å®¡æ‰¹æ¶ˆæ¯å†…å®¹\"}"
   }
   ```

3. **è½®è¯¢æ£€æŸ¥å›å¤**
   ```
   GET https://open.feishu.cn/open-apis/im/v1/messages?container_id_type=chat&container_id={chat_id}
   Headers: {
     "Authorization": "Bearer {tenant_access_token}"
   }
   ```

### Claude Haiku API è°ƒç”¨

```
POST https://d01bad1e79ad-vip.aicoding.sh/v1/messages
Headers: {
  "x-api-key": "aicoding-617126d04e7745e2c593d78665552c7f",
  "anthropic-version": "2023-06-01",
  "content-type": "application/json"
}
Body: {
  "model": "claude-haiku-3-5",
  "max_tokens": 1024,
  "messages": [
    {
      "role": "user",
      "content": "åˆ†æä»¥ä¸‹æ“ä½œçš„æ„å›¾å’Œé£é™©..."
    }
  ]
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **é£ä¹¦åº”ç”¨æƒé™**
   - ç¡®ä¿åº”ç”¨å·²æ·»åŠ  `im:message` æƒé™
   - ç¡®ä¿åº”ç”¨å·²å‘å¸ƒå¹¶å¯ç”¨

2. **å®¡æ‰¹è¶…æ—¶**
   - é»˜è®¤ 5 åˆ†é’Ÿè¶…æ—¶
   - è¶…æ—¶åè‡ªåŠ¨æ‹’ç»æ“ä½œ
   - ä¼šå‘é€è¶…æ—¶é€šçŸ¥åˆ°é£ä¹¦

3. **å¹¶å‘å®¡æ‰¹**
   - æ”¯æŒå¤šä¸ªå®¡æ‰¹è¯·æ±‚åŒæ—¶è¿›è¡Œ
   - æ¯ä¸ªè¯·æ±‚æœ‰å”¯ä¸€çš„ request_id
   - å›å¤æ—¶ä¼šè‡ªåŠ¨åŒ¹é…æœ€è¿‘çš„å¾…å®¡æ‰¹è¯·æ±‚

4. **æ¶ˆæ¯è½®è¯¢**
   - æ¯ 2 ç§’è½®è¯¢ä¸€æ¬¡
   - åªæ£€æŸ¥æœ€è¿‘ 10 åˆ†é’Ÿçš„æ¶ˆæ¯
   - é¿å…é‡å¤å¤„ç†å·²å¤„ç†çš„æ¶ˆæ¯

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æ”¶ä¸åˆ°é£ä¹¦æ¶ˆæ¯

**æ£€æŸ¥**ï¼š
- é£ä¹¦åº”ç”¨æ˜¯å¦å·²å‘å¸ƒï¼Ÿ
- åº”ç”¨æƒé™æ˜¯å¦åŒ…å« `im:message`ï¼Ÿ
- App ID å’Œ App Secret æ˜¯å¦æ­£ç¡®ï¼Ÿ
- ç”¨æˆ· ID æ˜¯å¦æ­£ç¡®ï¼Ÿ

**æµ‹è¯•**ï¼š
```bash
# æµ‹è¯•è·å– access token
curl -X POST https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal \
  -H "Content-Type: application/json" \
  -d '{
    "app_id": "xxxx",
    "app_secret": "***"
  }'
```

### é—®é¢˜ 2: Claude API è°ƒç”¨å¤±è´¥

**æ£€æŸ¥**ï¼š
- API Key æ˜¯å¦æ­£ç¡®ï¼Ÿ
- ç½‘ç»œæ˜¯å¦å¯ä»¥è®¿é—® `d01bad1e79ad-vip.aicoding.sh`ï¼Ÿ
- æ¨¡å‹åç§°æ˜¯å¦æ­£ç¡®ï¼Ÿï¼ˆ`claude-haiku-3-5`ï¼‰

**é™çº§æ–¹æ¡ˆ**ï¼š
- å¦‚æœ Claude ä¸å¯ç”¨ï¼Œä¼šè‡ªåŠ¨é™çº§åˆ°è§„åˆ™å¼•æ“æ¨¡å¼
- ä»ç„¶å¯ä»¥è¿›è¡Œé£é™©è¯„ä¼°å’Œå®¡æ‰¹

### é—®é¢˜ 3: å®¡æ‰¹å›å¤ä¸ç”Ÿæ•ˆ

**æ£€æŸ¥**ï¼š
- å›å¤çš„å…³é”®è¯æ˜¯å¦æ­£ç¡®ï¼Ÿï¼ˆ"æ‰¹å‡†"/"æ‹’ç»"ï¼‰
- æ˜¯å¦åœ¨ 5 åˆ†é’Ÿå†…å›å¤ï¼Ÿ
- æ˜¯å¦å›å¤åˆ°æ­£ç¡®çš„ä¼šè¯ï¼Ÿ

**è°ƒè¯•**ï¼š
- æŸ¥çœ‹ Diting ç»ˆç«¯è¾“å‡º
- æŸ¥çœ‹å®¡è®¡æ—¥å¿— `logs/audit.jsonl`

## ğŸ“ ä¸‹ä¸€æ­¥

1. âœ… é…ç½®å·²å®Œæˆ
2. â³ ç­‰å¾…ä»£ç ç”Ÿæˆå®Œæˆ
3. â³ ç¼–è¯‘å¹¶æµ‹è¯•
4. â³ éªŒè¯å®¡æ‰¹æµç¨‹

---

**çŠ¶æ€**: ğŸš§ ä»£ç ç”Ÿæˆä¸­  
**é¢„è®¡å®Œæˆ**: 10-15 åˆ†é’Ÿ  
**é…ç½®æ–‡ä»¶**: `/home/dministrator/workspace/sentinel-ai/cmd/diting/config.json`
