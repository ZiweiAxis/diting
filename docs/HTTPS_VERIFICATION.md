# HTTPS ä»£ç†åŠŸèƒ½éªŒè¯æ¸…å•

## âš ï¸ é‡è¦æç¤º

**ä»£ç å·²æäº¤ä½†æœªåœ¨å®é™…ç¯å¢ƒä¸­éªŒè¯ï¼**

éœ€è¦åœ¨æœ‰ Go ç¯å¢ƒçš„æœºå™¨ä¸Šè¿›è¡Œå®Œæ•´æµ‹è¯•ã€‚

---

## ğŸ“‹ éªŒè¯æ¸…å•

### 1. ç¼–è¯‘æµ‹è¯•

```bash
cd cmd/diting
go build -o diting main.go
```

**é¢„æœŸç»“æœ**: 
- [ ] ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯
- [ ] ç”Ÿæˆ `diting` å¯æ‰§è¡Œæ–‡ä»¶

**å¯èƒ½çš„é—®é¢˜**:
- ä¾èµ–åŒ…ç¼ºå¤±: `go mod tidy`
- è¯­æ³•é”™è¯¯: æ£€æŸ¥ä»£ç 

---

### 2. å¯åŠ¨æµ‹è¯•

```bash
./diting
```

**é¢„æœŸç»“æœ**:
- [ ] æ˜¾ç¤ºå¯åŠ¨æ¨ªå¹…
- [ ] ç›‘å¬ :8080 ç«¯å£
- [ ] æ— å´©æºƒ

**å¯èƒ½çš„é—®é¢˜**:
- ç«¯å£è¢«å ç”¨: ä¿®æ”¹ config.ProxyListen
- æƒé™é—®é¢˜: ä½¿ç”¨éç‰¹æƒç«¯å£

---

### 3. HTTP ä»£ç†æµ‹è¯•

```bash
# ç»ˆç«¯ 1: å¯åŠ¨ diting
./diting

# ç»ˆç«¯ 2: æµ‹è¯• HTTP
curl -x http://localhost:8080 http://httpbin.org/get
```

**é¢„æœŸç»“æœ**:
- [ ] Diting æ˜¾ç¤º "æ”¶åˆ° HTTP è¯·æ±‚"
- [ ] é£é™©ç­‰çº§: ä½ ğŸŸ¢
- [ ] å†³ç­–: è‡ªåŠ¨æ”¾è¡Œ
- [ ] curl è¿”å›æ­£å¸¸å“åº”

**å¯èƒ½çš„é—®é¢˜**:
- è¿æ¥è¶…æ—¶: æ£€æŸ¥ç½‘ç»œ
- ä»£ç†æ‹’ç»: æ£€æŸ¥é£é™©è¯„ä¼°é€»è¾‘

---

### 4. HTTPS ä»£ç†æµ‹è¯•ï¼ˆå®‰å…¨åŸŸåï¼‰

```bash
curl -x http://localhost:8080 https://api.github.com/zen
```

**é¢„æœŸç»“æœ**:
- [ ] Diting æ˜¾ç¤º "æ”¶åˆ° HTTPS è¯·æ±‚"
- [ ] ç›®æ ‡: api.github.com:443
- [ ] é£é™©ç­‰çº§: ä½ ğŸŸ¢
- [ ] å†³ç­–: è‡ªåŠ¨æ”¾è¡Œ
- [ ] curl è¿”å› GitHub çš„ zen è¯­å½•

**å¯èƒ½çš„é—®é¢˜**:
- "Proxy CONNECT aborted": è¿æ¥è¢«æ‹’ç»
- è¯ä¹¦é”™è¯¯: ä½¿ç”¨ `curl -k`

---

### 5. HTTPS ä»£ç†æµ‹è¯•ï¼ˆæœªçŸ¥åŸŸåï¼‰

```bash
curl -x http://localhost:8080 https://api.example.com/data
```

**é¢„æœŸç»“æœ**:
- [ ] Diting æ˜¾ç¤º "æ”¶åˆ° HTTPS è¯·æ±‚"
- [ ] é£é™©ç­‰çº§: ä¸­ ğŸŸ¡
- [ ] æ˜¾ç¤º LLM æ„å›¾åˆ†æ
- [ ] æç¤º "æ˜¯å¦æ‰¹å‡†æ­¤è¿æ¥? (y/n):"
- [ ] è¾“å…¥ y åï¼Œcurl ç»§ç»­æ‰§è¡Œ

**å¯èƒ½çš„é—®é¢˜**:
- å®¡æ‰¹è¶…æ—¶: å¢åŠ è¶…æ—¶æ—¶é—´
- LLM ä¸å¯ç”¨: ä½¿ç”¨è§„åˆ™å¼•æ“é™çº§

---

### 6. Python requests æµ‹è¯•

```python
import requests

proxies = {
    'http': 'http://localhost:8080',
    'https': 'http://localhost:8080',
}

# HTTP æµ‹è¯•
response = requests.get('http://httpbin.org/get', proxies=proxies)
print("HTTP:", response.status_code)

# HTTPS æµ‹è¯•
response = requests.get('https://api.github.com/zen', proxies=proxies)
print("HTTPS:", response.text)
```

**é¢„æœŸç»“æœ**:
- [ ] HTTP è¯·æ±‚æˆåŠŸ
- [ ] HTTPS è¯·æ±‚æˆåŠŸ
- [ ] Diting æ­£ç¡®è®°å½•ä¸¤æ¬¡è¯·æ±‚

---

### 7. å®¡è®¡æ—¥å¿—éªŒè¯

```bash
cat logs/audit.jsonl | tail -5 | jq '.'
```

**é¢„æœŸç»“æœ**:
- [ ] æ—¥å¿—æ–‡ä»¶å­˜åœ¨
- [ ] åŒ…å« HTTP å’Œ HTTPS è¯·æ±‚è®°å½•
- [ ] JSON æ ¼å¼æ­£ç¡®
- [ ] åŒ…å«å¿…è¦å­—æ®µ: timestamp, method, host, decision

**ç¤ºä¾‹æ—¥å¿—**:
```json
{
  "timestamp": "2026-02-08T07:45:00Z",
  "method": "CONNECT",
  "host": "api.github.com:443",
  "path": "/",
  "risk_level": "ä½",
  "decision": "ALLOW",
  "response_code": 200,
  "duration_ms": 150
}
```

---

### 8. æ€§èƒ½æµ‹è¯•

```bash
# å¹¶å‘ 10 ä¸ªè¯·æ±‚
for i in {1..10}; do
  curl -x http://localhost:8080 https://api.github.com/zen &
done
wait
```

**é¢„æœŸç»“æœ**:
- [ ] æ‰€æœ‰è¯·æ±‚æˆåŠŸ
- [ ] æ— å´©æºƒ
- [ ] å“åº”æ—¶é—´åˆç†ï¼ˆ< 2sï¼‰

---

### 9. é”™è¯¯å¤„ç†æµ‹è¯•

```bash
# æµ‹è¯•æ— æ•ˆåŸŸå
curl -x http://localhost:8080 https://invalid-domain-12345.com

# æµ‹è¯•è¿æ¥è¶…æ—¶
curl -x http://localhost:8080 https://httpbin.org:9999 -m 5
```

**é¢„æœŸç»“æœ**:
- [ ] ä¼˜é›…å¤„ç†é”™è¯¯
- [ ] è¿”å›åˆç†çš„é”™è¯¯ä¿¡æ¯
- [ ] ä¸å´©æºƒ

---

## ğŸ› å·²çŸ¥é—®é¢˜

### 1. ä»£ç æœªåœ¨å®é™…ç¯å¢ƒéªŒè¯

**çŠ¶æ€**: âš ï¸ æœªéªŒè¯  
**é£é™©**: å¯èƒ½å­˜åœ¨è¿è¡Œæ—¶é”™è¯¯  
**å»ºè®®**: åœ¨æœ‰ Go ç¯å¢ƒçš„æœºå™¨ä¸Šå®Œæ•´æµ‹è¯•

### 2. ä¾èµ–åŒ…å¯èƒ½ç¼ºå¤±

**é—®é¢˜**: `github.com/fatih/color` å¯èƒ½æœªå®‰è£…  
**è§£å†³**: 
```bash
cd cmd/diting
go mod tidy
go get github.com/fatih/color
```

### 3. HTTPS éš§é“å¯èƒ½ä¸ç¨³å®š

**é—®é¢˜**: TCP éš§é“çš„åŒå‘è½¬å‘å¯èƒ½æœ‰ bug  
**å»ºè®®**: æµ‹è¯•å¤§æ–‡ä»¶ä¼ è¾“å’Œé•¿è¿æ¥

### 4. å¹¶å‘å¤„ç†æœªä¼˜åŒ–

**é—®é¢˜**: æ¯ä¸ªè¿æ¥éƒ½ä¼šé˜»å¡  
**å»ºè®®**: ä½¿ç”¨ goroutine å¤„ç†å¹¶å‘è¿æ¥

---

## âœ… éªŒè¯æ­¥éª¤

### æœ€å°éªŒè¯ï¼ˆ5åˆ†é’Ÿï¼‰

1. ç¼–è¯‘ä»£ç 
2. å¯åŠ¨æœåŠ¡
3. æµ‹è¯•ä¸€ä¸ª HTTP è¯·æ±‚
4. æµ‹è¯•ä¸€ä¸ª HTTPS è¯·æ±‚
5. æ£€æŸ¥å®¡è®¡æ—¥å¿—

### å®Œæ•´éªŒè¯ï¼ˆ30åˆ†é’Ÿï¼‰

1. æ‰€æœ‰ä¸Šè¿°æµ‹è¯•
2. æ€§èƒ½æµ‹è¯•
3. é”™è¯¯å¤„ç†æµ‹è¯•
4. é•¿æ—¶é—´è¿è¡Œæµ‹è¯•
5. å†…å­˜æ³„æ¼æ£€æŸ¥

---

## ğŸ“ æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

```markdown
## æµ‹è¯•ç¯å¢ƒ
- OS: 
- Go ç‰ˆæœ¬: 
- æµ‹è¯•æ—¶é—´: 

## æµ‹è¯•ç»“æœ
- [ ] ç¼–è¯‘æˆåŠŸ
- [ ] HTTP ä»£ç†æ­£å¸¸
- [ ] HTTPS ä»£ç†æ­£å¸¸
- [ ] å®¡è®¡æ—¥å¿—æ­£å¸¸
- [ ] æ€§èƒ½å¯æ¥å—

## å‘ç°çš„é—®é¢˜
1. 
2. 
3. 

## å»ºè®®æ”¹è¿›
1. 
2. 
3. 
```

---

## ğŸš¨ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³éœ€è¦åšçš„

1. **åœ¨æœ‰ Go ç¯å¢ƒçš„æœºå™¨ä¸Šæµ‹è¯•**
   - ç¼–è¯‘ä»£ç 
   - è¿è¡ŒåŸºç¡€æµ‹è¯•
   - ä¿®å¤å‘ç°çš„ bug

2. **åˆ›å»ºè‡ªåŠ¨åŒ–æµ‹è¯•**
   - å•å…ƒæµ‹è¯•
   - é›†æˆæµ‹è¯•
   - ç«¯åˆ°ç«¯æµ‹è¯•

3. **æ€§èƒ½ä¼˜åŒ–**
   - å¹¶å‘å¤„ç†
   - è¿æ¥æ± 
   - å†…å­˜ä¼˜åŒ–

---

**çŠ¶æ€**: âš ï¸ ä»£ç å·²æäº¤ï¼Œç­‰å¾…éªŒè¯  
**ä¼˜å…ˆçº§**: P0 - ç´§æ€¥  
**è´Ÿè´£äºº**: å¾…å®š
